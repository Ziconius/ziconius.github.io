<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Deploying C2 Infrastructure to Kube using GKE - Ziconius@localhost:~$  whoami</title>
<meta name="description" content="Deploying C2 infrastructure can be slow and tedious as hell, and that why theres now so many tools to automate deployments.  ">


  <meta name="author" content="Kris">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Ziconius@localhost:~$  whoami">
<meta property="og:title" content="Deploying C2 Infrastructure to Kube using GKE">
<meta property="og:url" content="http://localhost:4000/security/test-page/">


  <meta property="og:description" content="Deploying C2 infrastructure can be slow and tedious as hell, and that why theres now so many tools to automate deployments.  ">







  <meta property="article:published_time" content="2020-05-14T00:00:00+01:00">



  <meta property="article:modified_time" content="2020-05-14T09:32:03+01:00">




<link rel="canonical" href="http://localhost:4000/security/test-page/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ziconius@localhost:~$  whoami Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Ziconius@localhost:~$  whoami
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/bio-photo.jpg" alt="Kris" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kris</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Offensive security &amp; C2 author.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://twitter.com/ziconius" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/FudgeC2" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Deploying C2 Infrastructure to Kube using GKE">
    <meta itemprop="description" content="Deploying C2 infrastructure can be slow and tedious as hell, and that why theres now so many tools to automate deployments.">
    <meta itemprop="datePublished" content="2020-05-14T00:00:00+01:00">
    <meta itemprop="dateModified" content="2020-05-14T09:32:03+01:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Deploying C2 Infrastructure to Kube using GKE
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Deploying C2 infrastructure can be slow and tedious as hell, and that why theres now so many tools to automate deployments.</p>

<p>In this blog I’m going to discuss the deploying FudgeC2 to GKE along with other requirements, including TLS, and redirectors.</p>

<p>The blog will be broken down into 4 stages with the first logical step, stepping up Google Kube Engine (GKE), and the actual kubeCTL deployments switched. Why? Most people won’t need or want the GKE components and instead will be using Kube on ESXi/AWS/<hypervisor of="" choice=""> and will only be interested in the Kube components.</hypervisor></p>

<p>The blogs goal is to create a reference point for Kube C2 deployments and introducing people to new concepts</p>

<p>TLS certificates, and redirectors, and</p>

<p>Before we begin we’ll be looking at a quick overview of what a typical C” infrastruture looks like.</p>

<p>In a typical deployment we’ll have the C2 Server (or team server), redirectors, and implants.</p>

<p>In most test environments the use of redirectors is overlooked as they create additional overhead on setup, and offer protections against something which doesn’t exist in s test environment, the blue team.</p>

<p>A Typical test C2 environment looks like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------                                -----------
| C2 | &lt;---- malware.moozle.wtf ----&gt; | Implant |
------                                -----------
   ^                               -----------
   | --------- 10.10.10.17 -----&gt;  | Implant |
                                   -----------
</code></pre></div></div>
<p>The problem with this deployment is 2 fold, the first is that it if the IP range your C2 server is on is automatically blocks by tooling or an analyst then you’ll have to migrate your entire C2 server.</p>

<p>This may not actually be possible, if you’ve created an implant with a hardcoded IP address (while this is uncommon we do need the flexibility to do so).</p>

<p>Secondly, it’s a pretty big give away if they browse to malware.moozle.wtf:5001 and theres a fudgeC2 login page staring them in the face…</p>

<p>To resolve this issue we use redirectors. These act as simple proxies which hide the location of the C2 server. This means if our domain is burnt by the Blueteam we can fallback to another domain, using a different redirector.</p>

<p>Redirectors are designed to be lightweight and quick to deploy, and should be protocol agnostic.</p>

<p>Deploying on Kube:
Right - you’ve set up your Kube cluster, and we need to start deploying infrastructure? This is the easy bit, using KubeCTL we simple download the following file, and run:</p>

<p>kubectl create -f fudge-deploy.yaml</p>

<p>Great. Thats us done.</p>

<p>Assuming you’ve got very little knowledge of Kube, we can simplify what just happened:</p>

<p>We created a ‘deployment’ this contains all of the information relating to, well, this deployemnt of F2. Our server is deployed via a Docker pod (You can download the latest Docker of Fudge here: ziconius/FudgeC2:latest).</p>

<p>To access this pod we need to create ‘Services’, these act at routes into your pod. By default the FudgeC2 configuration exposes port 5001 to allow operators to access the C2 server and interact with implants.</p>

<p>We’ve created 3 load balencers in this situation, the first exposes port 80, and the second exposes 443.</p>

<p>There are numerous way to access different load balencers</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#command-and-control" class="page__taxonomy-item" rel="tag">Command and Control</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#kuberenetes" class="page__taxonomy-item" rel="tag">Kuberenetes</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#security" class="page__taxonomy-item" rel="tag">Security</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-05-14">May 14, 2020</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Deploying+C2+Infrastructure+to+Kube+using+GKE%20http%3A%2F%2Flocalhost%3A4000%2Fsecurity%2Ftest-page%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fsecurity%2Ftest-page%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fsecurity%2Ftest-page%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          
            
      </div>
    </div>
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/Ziconius" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Ziconius/FudgeC2" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Ziconius@localhost:~$  whoami. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
